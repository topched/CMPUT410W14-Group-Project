<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

{% load static %}
{% load markup %}
<html>
<head><title>MyNode Stream</title>
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" src="{% static 'js/jquery-1.11.0.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}"></script>

</head>

<body>
{% csrf_token %}
<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">MyNode</a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="/mynode/stream/">Stream</a></li>
                <li><a href="/mynode/friends/">Friends</a></li>

            </ul>


            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    {{ user.username }}
                    <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li>
                            <div class="navbar-content">
                                <div class="row">
                                    <div class="col-md-5">
                                        <img src="/static/img/DefaultProfile.jpg"
                                             alt="Alternate Text" class="img-thumbnail"/>
                                    </div>
                                    <div class="col-md-7">
                                        <span>{{ user.first_name }} {{ user.last_name }}</span>

                                        <p class="text-muted small">{{ user.email }}</p>

                                        <div class="divider">
                                        </div>
                                        <a href="/mynode/profile/" class="btn btn-primary btn-sm active">View
                                            Profile</a>
                                    </div>
                                </div>
                            </div>
                            <div class="navbar-footer">
                                <div class="navbar-footer-content">
                                    <div class="row">
                                        <div class="col-md-6">
                                        </div>
                                        <div class="col-md-6">
                                            <a href="{% url 'app.views.logout_view' %}" class="btn btn-default btn-sm pull-right">Sign Out</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </li>
            </ul>


        </div>
        <!--/.nav-collapse -->
    </div>
</div>

<div class=container>
    <div class=stream>
        <h1>Stream</h1>
        <!-- Post Input Box -->
        <form action="{% url 'app.views.create_post' %}" method="POST">
            {% csrf_token %}

                <div class=text_area>
                    <input type="text" class="form-control" placeholder="Title" id="title" name='title'>
                    <!--<textarea rows="5" cols="20" id="title" name='title'></textarea>-->
                </div>
                <textarea class="form-control" rows="3" name='content' placeholder="Content..."></textarea>
                <!--<textarea rows="5" cols="80" id="content" name='content'></textarea>-->
                <select class="form-control" name="content-type" style="width:200px;float:left;">
                    <option value="1">Plaintext</option>
                    <option value="2">Markdown</option>
                    <option value="3">HTML</option>
                </select>
                <select class="form-control" name="visibility" style="width:200px;float:left;">
                    <option value="1">Public</option>
                    <option value="2">Server Only</option>
                    <option value="3">Friends</option>
                    <option value="4">Private</option>
                </select>

                <div class=buttons>
                    <input type="submit" class="btn btn-primary" id="post" name="post" value="Post"/>
                </div>

        </form>
    </div>
</div>
</br>
</br>
<!-- Post Stream  --  NEED TO SHOW GITHUB STUFF IN STREAM STILL-->
{% for post in posts %}
    <div id="w">
        <div id="container">
            <ul id="comments">
                <li class="cmmnt">
                    <div class="avatar"><a href="javascript:void(0);"><img src="/static/img/DefaultProfile.jpg" width="55" height="55"></a></div>
                    <div class="cmmnt-content">
                        <header>{{ post.author.username }} - <span class="pubdate">Date Published - #TODO</span></header>
                        <p>
                        {% if post.content_type == 1 %}
                            <p> {{ post.content }} </p>
                        {% elif post.content_type == 2 %}
                            <p> {{ post.content|convert_markdown }} </p>
                        {% elif post.content_type == 3 %}
                            <p> {{ post.content|sanitize_html|safe }} </p>
                        {% endif %}
                        </p>
                    </div>

                    {% for comment in comments %}
                    {% if post == comment.parent_post %}

                        <ul class="replies">
                            <li class="cmmnt">
                                <div class="avatar"><a href="javascript:void(0);"><img src="/static/img/DefaultProfile.jpg" width="55" height="55"></a></div>
                                <div class="cmmnt-content">
                                    <header>{{ comment.author.username }} - <span class="pubdate">Date Published - #TODO</span></header>
                                    <p>{{ comment.content }}</p>
                                </div>
                            </li>
                        </ul>

                    {% endif %}
                    {% endfor %}

                </li>
            </ul>

            <div class="row">
            <div class="stream_buttons">
            <form action="{% url 'app.views.delete_post' post.id %}" method="POST">
                {% csrf_token %}
                <input class="btn btn-primary" type="button" value="Comment" id="comment_button"/>
                {% if post.author == current_user %}
                    <input class="btn btn-primary" type="submit" value="Delete"/>
                {% endif %}
            </form>
            </div>

            <div class="comment_area" style="display:none">
                <form action="{% url 'app.views.create_comment' post.id %}" method="POST">
                    {% csrf_token %}
                    <textarea class="form-control" name='content'></textarea>
                    </br>
                    <div class="comment_buttons">
                        <input class="btn btn-primary" type="submit" id="post_comment" name="post" value="Post"/>
                        <input class="btn btn-primary" type="button" value="Cancel" id='cancel-button'/>
                    </div>
                </form>
            </div>
            </div>

        </div>
    </div>
{% endfor %}
</br></br>


<!-- Dynamic Comments -->
<script type="text/javascript">


    $(function () {

        $(document).on("click", "#comment_button", function() {
            $(this).closest(".row").find(".comment_area").show();
            $(this).closest(".row").find(".comment_buttons").show();
            $(this).closest(".row").find(".stream_buttons").hide();
        });

        $(document).on("click", "#cancel-button", function() {
            $(this).closest(".row").find(".comment_area").hide();
            $(this).closest(".row").find("post_buttons").hide();
            $(this).closest(".row").find(".comment_buttons").hide();
            $(this).closest(".row").find(".stream_buttons").show();
        });


    });

</script>
</body>


</html>
